<!DOCTYPE html><html lang="en"><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-55630862-3"></script><script async src="/scripts.js"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-55630862-3');</script><meta charset="utf-8"><title>Dprint Rewritten in Rust - dprint - Code Formatter</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#000000"><meta name="description" content="Overview of the new rust-based pluggable, configurable, and fast code formatting platform."><meta name="author" content="Dprint Code Formatting"><link rel="stylesheet" href="/style.css"></head><body><nav class="navbar" role="navigation" aria-label="main navigation"><div class="navbar-brand"><h1 class="title"><a href="/">dprint</a></h1><a role="button" id="navbarBurger" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarLinks"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu" id="navbarLinks"><div class="navbar-end"><a class="navbar-item" href="/overview">Overview</a> <a class="navbar-item" href="/playground">Playground</a> <a class="navbar-item" href="/pricing">Pricing</a> <a class="navbar-item" href="https://github.com/dprint/dprint" rel="noopener noreferrer">View on GitHub</a></div></div></nav><section class="section" id="content"><article id="content-body" class="container"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/blog">Blog</a></li></ul></nav><h1 class="title">Dprint Rewritten in Rust</h1><div class="blog-date-author"><time datetime="2020-07-15">2020-07-15</time> by <a href="https://github.com/dsherret">David Sherret</a></div><p>Dprint is a pluggable, configurable, and fast automated code formatting platform now written in Rust.</p><p>I've been working on dprint since June 2019. It started as a Node project creating a TypeScript code formatter that worked the way I wanted in my personal open source projects. It's progressed a long way and I'll walk through some of the highlights in this post.</p><h2 id="short-video-demonstrations">Short Video Demonstrations</h2><p>Editor demo with "format on save" enabled:</p><video width="600" height="366" poster="/videos/editor-demo-thumbnail.png" controls><source src="/videos/editor-demo.mp4" type="video/mp4"><p>Your browser doesn't support HTML5 video. See video <a href="/videos/editor-demo.mp4">here</a>.</p></video><p>CLI demo:</p><video width="600" height="366" poster="/videos/cli-demo-thumbnail.png" controls><source src="/videos/cli-demo.mp4" type="video/mp4"><p>Your browser doesn't support HTML5 video. See video <a href="/videos/cli-demo.mp4">here</a>.</p></video><h2 id="single-executable">Single Executable</h2><p>Dprint is distributed as a single executable with no dependencies. You may build it from the source or install it using one of the methods outlined on the <a href="/install">install page</a>.</p><h2 id="webassembly-formatter-plugins">WebAssembly Formatter Plugins</h2><p>The dprint CLI (command line interface/executable) has no knowledge of how to format code in a specific language. This is left up to the plugins. For example, if you want to format JSON code then you must specify to use a JSON code formatting plugin.</p><p>Plugins are specified per codebase in a configuration file (<em>.dprintrc.json</em>) found at the root directory or <code>config</code> folder of a codebase.</p><pre><code class="json language-json">{
  <span class="hljs-comment">// ...omitted...</span>
  <span class="hljs-attr">"plugins"</span>: [
    <span class="hljs-comment">// these may be urls or file paths</span>
    <span class="hljs-string">"https://plugins.dprint.dev/typescript-x.x.x.wasm"</span>, <span class="hljs-comment">// supports TypeScript and JavaScript</span>
    <span class="hljs-string">"https://plugins.dprint.dev/json-x.x.x.wasm"</span>,
    <span class="hljs-string">"https://plugins.dprint.dev/rustfmt-x.x.x.wasm"</span>,
    <span class="hljs-string">"https://plugins.dprint.dev/markdown-x.x.x.wasm"</span>
  ]
}</code></pre><p>As you can see above, plugins are distributed as WebAssembly files. This means they're portable across systems and run sandboxed when executed. Plugins have no network or file system access—they only receive text to format and provide a text result.</p><p>On first run, dprint will take a few seconds to download, compile, and cache the specified plugins in parallel. After that, they load in about 5-40ms on my machine depending on the plugin size.</p><h2 id="language-support-plugins">Language Support (Plugins)</h2><ul><li><a href="/plugins/typescript">Typescript / JavaScript</a></li><li><a href="/plugins/json">JSON</a></li><li><a href="/plugins/markdown">Markdown</a></li><li><a href="/plugins/rustfmt">Rust</a> via Rustfmt</li></ul><p>More languages will be added over time.</p><h2 id="performance">Performance</h2><p>Dprint is the fastest code formatter for TypeScript, JSON, and Markdown code that I know of.</p><p>For example, <a href="https://deno.land/">Deno</a> recently switched from prettier to dprint for their internal code formatting and TypeScript, JSON, and Markdown formatting time dropped from <strong>14.7s</strong> to <strong>2.2s</strong> on my machine.</p><h2 id="using-plugins-outside-the-cli">Using Plugins Outside the CLI</h2><p>Since dprint plugins are distributed as WebAssembly files, they have the added benefit of being usable in other environments such as the browser.</p><p>For example, this code uses the Rustfmt dprint plugin to format Rust code in Deno:</p><pre><code class="ts language-ts"><span class="hljs-comment">// documentation: https://doc.deno.land/https/dprint.dev/formatter/v1.ts</span>
<span class="hljs-keyword">import</span> { createStreaming } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://dprint.dev/formatter/v1.ts"</span>;

<span class="hljs-keyword">const</span> globalConfig = {
    indentWidth: <span class="hljs-number">2</span>,
    lineWidth: <span class="hljs-number">80</span>,
};
<span class="hljs-keyword">const</span> rustFormatter = <span class="hljs-keyword">await</span> createStreaming(
    fetch(<span class="hljs-string">"https://plugins.dprint.dev/rustfmt-0.1.0.wasm"</span>),
);

rustFormatter.setConfig(globalConfig, { brace_style: <span class="hljs-string">"AlwaysNextLine"</span> });

<span class="hljs-comment">// outputs "fn test()\n{\n  println!("test")\n}\n"</span>
<span class="hljs-built_in">console</span>.log(rustFormatter.formatText(<span class="hljs-string">"file.rs"</span>, <span class="hljs-string">"fn test() {println!(\"test\")}"</span>));</code></pre><h2 id="configuration">Configuration</h2><p>The amount of configuration a plugin offers is up to the plugin itself. A plugin may have zero configuration or a lot. The existing plugins are highly configurable to allow you to format code closer to your preferences rather than my prescriptions.</p><p>Here's an example of how a <code>.dprintrc.json</code> file might look like:</p><pre><code class="json language-json">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"https://dprint.dev/schemas/v0.json"</span>,
  <span class="hljs-attr">"projectType"</span>: <span class="hljs-string">"openSource"</span>,
  <span class="hljs-attr">"lineWidth"</span>: <span class="hljs-number">160</span>,
  <span class="hljs-attr">"typescript"</span>: {
    <span class="hljs-attr">"arrowFunction.useParentheses"</span>: <span class="hljs-string">"preferNone"</span>,
    <span class="hljs-attr">"bracePosition"</span>: <span class="hljs-string">"nextLine"</span>,
    <span class="hljs-attr">"preferHanging"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"semiColons"</span>: <span class="hljs-string">"asi"</span>,
    <span class="hljs-attr">"singleBodyPosition"</span>: <span class="hljs-string">"nextLine"</span>
  },
  <span class="hljs-attr">"json"</span>: {
    <span class="hljs-attr">"indentWidth"</span>: <span class="hljs-number">2</span>
  },
  <span class="hljs-attr">"includes"</span>: [
    <span class="hljs-string">"**/*.{ts,tsx,js,jsx,json,md,rs}"</span>
  ],
  <span class="hljs-attr">"excludes"</span>: [
    <span class="hljs-string">"**/node_modules"</span>,
    <span class="hljs-string">"**/dist"</span>,
    <span class="hljs-string">"**/target"</span>,
    <span class="hljs-string">"**/*-lock.json"</span>
  ],
  <span class="hljs-attr">"plugins"</span>: [
    <span class="hljs-string">"https://plugins.dprint.dev/typescript-x.x.x.wasm"</span>,
    <span class="hljs-string">"https://plugins.dprint.dev/json-x.x.x.wasm"</span>,
    <span class="hljs-string">"https://plugins.dprint.dev/rustfmt-x.x.x.wasm"</span>,
    <span class="hljs-string">"https://plugins.dprint.dev/markdown-x.x.x.wasm"</span>
  ]
}</code></pre><p>To help create a <code>.dprintrc.json</code> file in your codebase, you may consider running the <code>dprint init</code> command.</p><h2 id="extending-configurations">Extending Configurations</h2><p>You may extend other configuration files by specifying an <code>extends</code> property. This may be a file path, URL, or relative path (remote configuration may extend other configuration files via a relative path).</p><!-- dprint-ignore --><pre><code class="json language-json">{
  <span class="hljs-attr">"extends"</span>: <span class="hljs-string">"https://dprint.dev/path/to/config/file.v1.json"</span>,
  <span class="hljs-comment">// ...omitted...</span>
}</code></pre><p>Referencing multiple configuration files is also supported. These should be ordered by precedence:</p><pre><code class="json language-json">{
  <span class="hljs-attr">"extends"</span>: [
    <span class="hljs-string">"https://dprint.dev/path/to/config/file.v1.json"</span>,
    <span class="hljs-string">"https://dprint.dev/path/to/config/other.v1.json"</span>
  ]
}</code></pre><h2 id="opinionated-configuration">Opinionated Configuration</h2><p>The decision to use an opinionated configuration is one you can make within dprint itself. Dprint provides a way to distribute "locked" configurations.</p><p>This can be done by specifying a <code>"locked": true</code> property on the plugin's configuration.</p><p>For example, say the following configuration file was hosted at <code>https://dprint.dev/configs/my-config.json</code>:</p><pre><code class="json language-json">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"https://dprint.dev/schemas/v0.json"</span>,
  <span class="hljs-attr">"typescript"</span>: {
    <span class="hljs-attr">"locked"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// note this property</span>
    <span class="hljs-attr">"lineWidth"</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">"indentWidth"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"useTabs"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"quoteStyle"</span>: <span class="hljs-string">"preferSingle"</span>,
    <span class="hljs-attr">"binaryExpression.operatorPosition"</span>: <span class="hljs-string">"sameLine"</span>
  },
  <span class="hljs-attr">"json"</span>: {
    <span class="hljs-attr">"locked"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// note this property</span>
    <span class="hljs-attr">"lineWidth"</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">"indentWidth"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"useTabs"</span>: <span class="hljs-literal">false</span>
  }
}</code></pre><p>This would allow people to use it like so:</p><pre><code class="json language-json">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"https://dprint.dev/schemas/v0.json"</span>,
  <span class="hljs-attr">"extends"</span>: <span class="hljs-string">"https://dprint.dev/configs/my-config.json"</span>,
  <span class="hljs-attr">"plugins"</span>: [
    <span class="hljs-string">"https://plugins.dprint.dev/typescript-x.x.x.wasm"</span>,
    <span class="hljs-string">"https://plugins.dprint.dev/json-x.x.x.wasm"</span>
  ]
}</code></pre><p>But consumers specifying properties in the <code>"typescript"</code> or <code>"json"</code> objects of their config file would cause an error when running in the CLI:</p><pre><code class="json language-json">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"https://dprint.dev/schemas/v0.json"</span>,
  <span class="hljs-attr">"extends"</span>: <span class="hljs-string">"https://dprint.dev/configs/my-config.json"</span>,
  <span class="hljs-attr">"typescript"</span>: {
    <span class="hljs-attr">"useBraces"</span>: <span class="hljs-string">"always"</span> <span class="hljs-comment">// error, "typescript" config was locked</span>
  },
  <span class="hljs-attr">"json"</span>: {
    <span class="hljs-attr">"lineWidth"</span>: <span class="hljs-number">120</span> <span class="hljs-comment">// error, "json" config was locked</span>
  },
  <span class="hljs-attr">"plugins"</span>: [
    <span class="hljs-string">"https://plugins.dprint.dev/typescript-x.x.x.wasm"</span>,
    <span class="hljs-string">"https://plugins.dprint.dev/json-x.x.x.wasm"</span>
  ]
}</code></pre><p>For more information on configuration files beyond what's outlined here, see the <a href="/config">configuration documentation</a>.</p><h2 id="opinionated-white-labeled-binaries">Opinionated White-Labeled Binaries</h2><p>If you wish to have an opinionated white-labeled binaries locked to a specific configuration for your company, please <a href="/contact">get in touch</a> as I will offer this as a separate service.</p><h2 id="pricing">Pricing</h2><p>Dprint is and will always be free for formatting open source projects whose primary maintainer is not a for-profit company. Unfortunately dprint's growth isn't sustainable without support from for-profit companies and this support would help drive this project forward. If you wish to use dprint on a code base whose primary maintainer is a for-profit company or individual, then you must purchase a license. See <a href="https://dprint.dev/pricing/">pricing</a> for more details.</p><p>If you're not a commercial user and excited about the project, consider sponsoring at <a href="https://github.com/sponsors/dprint">https://github.com/sponsors/dprint</a></p><h2 id="future">Future</h2><p>Dprint is still in the early stages, so there's still a lot of work to do. Overall, the main goals are to…</p><ol><li>Continue improving support for existing languages.</li><li>Expand support to other languages.</li><li>Develop debugging and analysis tools to make dprint faster and speed up development.</li><li>Improve the underlying core algorithm to support more scenarios.</li></ol><p>Thanks for reading!</p></article></section><footer class="footer"><div><div class="level"><div class="level-left"><p class="level-item"><a href="/">Home</a></p><p class="level-item"><a href="/contact">Contact Us</a></p><p class="level-item"><a href="/privacy-policy">Privacy Policy</a></p></div><div class="level-right"><p class="level-item"><a href="/blog">Blog</a></p><p class="level-item"><a href="https://twitter.com/dprintfmt">Twitter</a></p><p class="level-item"><a href="https://github.com/dprint">GitHub</a></p></div></div></div></footer></body></html>